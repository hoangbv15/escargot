{%- from 'msn:_funcs.xml' import contact_entry, group_entry, generate_me_entry, ab_properties -%}

<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
	<soap:Header>
		<ServiceHeader xmlns="http://www.msn.com/webservices/AddressBook">
			<Version>15.01.1408.0000</Version>
			<CacheKey>12r1:{{ cachekey }}</CacheKey>
			<CacheKeyChanged>true</CacheKeyChanged>
			<PreferredHostName>{{ host }}</PreferredHostName>
			<SessionId>{{ session_id }}</SessionId>
		</ServiceHeader>
	</soap:Header>
	<soap:Body>
		<ABFindContactsPagedResponse xmlns="http://www.msn.com/webservices/AddressBook">
			<ABFindContactsPagedResult>
				{%- if ab_id == '00000000-0000-0000-0000-000000000000' and user_creator_detail -%}
					{%- if user_creator_detail.groups_by_uuid -%}
						<Groups>
							{% for group in user_creator_detail._groups_by_uuid.values() %}
								{{ group_entry(group) }}
							{% endfor %}
						</Groups>
					{%- endif -%}
				{%- endif -%}
				{%- if ab_contacts -%}
					<Contacts>
						{%- for contact in ab_contacts.values() -%}
							<Contact>
							{{ contact_entry(ab_id, contact, user_creator_detail) }}
							</Contact>
						{%- endfor -%}
						{{ generate_me_entry(ab_id, user_creator, now) }}
					</Contacts>
				{%- endif -%}
				<CircleResult>
					{%- if circle_info|length > 0 -%}
						<Circles>
							{%- for circle, membership_info in circle_info -%}
								{%- if membership_info -%}
									<CircleInverseInfo>
										<Content>
											<Handle>
												<Id>{{ circle.circle_id }}</Id>
											</Handle>
											<Info>
												<Domain>1</Domain>
												<HostedDomain>live.com</HostedDomain>
												<Type>2</Type>
												<MembershipAccess>{{ circle.membership_access }}</MembershipAccess>
												<IsPresenceEnabled>{{ bool_to_str(circle.is_presence_enabled) }}</IsPresenceEnabled>
												<RequestMembershipOption>{{ circle.request_membership_option }}</RequestMembershipOption>
												<DisplayName>{{ circle.circle_name }}</DisplayName>
												<ProfileLastUpdated>0001-01-01T00:00:00</ProfileLastUpdated>
												<Changes />
												<CreateDate>0001-01-01T00:00:00</CreateDate>
												<LastChanged>{{ date_format(circle.date_last_modified, Z = False) }}</LastChanged>
											</Info>
										</Content>
										<PersonalInfo>
											<MembershipInfo>
												<CirclePersonalMembership>
													<Role>{{ membership_info.role.name }}</Role>
													<State>{{ membership_info.state.name }}</State>
												</CirclePersonalMembership>
											</MembershipInfo>
											<Name>{{ circle.circle_name }}</Name>
											<IsNotMobileVisible>false</IsNotMobileVisible>
											<IsFavorite>false</IsFavorite>
											<IsFamily>false</IsFamily>
											<Changes />
										</PersonalInfo>
										<Deleted>false</Deleted>
									</CircleInverseInfo>
								{%- endif -%}
							{%- endfor -%}
						</Circles>
					{%- endif -%}
					<CircleTicket>
					{{ signedticket }}
					</CircleTicket>
				</CircleResult>
				<Ab>
				{{ ab_properties(ab_id, user_creator, ab_type, ab_created, ab_last_modified, True) }}
				</Ab>
			</ABFindContactsPagedResult>
		</ABFindContactsPagedResponse>
	</soap:Body>
</soap:Envelope>